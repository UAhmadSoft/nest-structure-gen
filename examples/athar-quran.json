{
  "char_primary_key": false,
  "controller_module_file": "D:/projects/authar-quran-api/src/infrastructure/controllers/controller.module.ts",
  "entity_module_file": "D:/projects/authar-quran-api/src/infrastructure/entities/db.ts",
  "insert_to_modules": false,
  "repository_module_file": "D:/projects/authar-quran-api/src/infrastructure/repository/repository.module.ts",
  "url": "D:/projects/authar-quran-api/src",
  "usecase_module_file": "D:/projects/authar-quran-api/src/usecases/usecase.module.ts",
  "tables": [
    {
      "name": "Translations",
      "create_pagination_route": false,
      "create_relation_get_route": false,
      "properties": {
        "slug": {
          "type": "varchar",
          "required": true
        },
        "language": {
          "type": "varchar",
          "required": true
        },
        "display_name": {
          "type": "text",
          "required": true
        },
        "download_url": {
          "type": "varchar",
          "required": false
        }
      },
      "relations": {
        "ayah_translations": {
          "type": "OneToMany",
          "entity": "AyahTranslations"
        }
      }
    },
    {
      "name": "AyahTranslations",
      "create_pagination_route": false,
      "create_relation_get_route": false,
      "properties": {
        "ayah_number": {
          "type": "int4",
          "required": true
        },
        "surah_number": {
          "type": "int4",
          "required": true
        },
        "text": {
          "type": "text",
          "required": true
        },
        "plain_text": {
          "type": "text",
          "required": false
        }
      },
      "relations": {
        "translation_id": {
          "type": "ManyToOne",
          "entity": "Translations",
          "required": true
        },
        "ayah_translation_mappings": {
          "type": "OneToMany",
          "entity": "AyahTranslationMappings"
        }
      }
    },
    {
      "name": "AyahTranslationMappings",
      "create_pagination_route": false,
      "create_relation_get_route": false,
      "properties": {},
      "relations": {
        "translation_id": {
          "type": "ManyToOne",
          "entity": "Translations",
          "required": true
        },
        "ayah_id": {
          "type": "ManyToOne",
          "entity": "Ayahs",
          "required": true
        },
        "ayah_translation_id": {
          "type": "ManyToOne",
          "entity": "AyahTranslations",
          "required": true
        }
      }
    },

    {
      "name": "Configurations",
      "create_pagination_route": false,
      "create_relation_get_route": false,
      "properties": {
        "key": {
          "type": "varchar",
          "length": 100,
          "required": true,
          "unique": true
        },
        "value": {
          "type": "text",
          "required": true
        },
        "datatype": {
          "type": "varchar",
          "length": 20,
          "required": true
        },
        "environment": {
          "type": "varchar",
          "length": 50,
          "required": false
        }
      },
      "relations": {}
    },
    {
      "name": "Reflections",
      "create_pagination_route": true,
      "create_relation_get_route": true,
      "properties": {
        "surah_number": {
          "type": "int4",
          "required": true
        },
        "ayah_number": {
          "type": "int4",
          "required": true
        },
        "language": {
          "type": "varchar",
          "length": 10,
          "required": true
        },
        "content": {
          "type": "text",
          "required": true
        },
        "is_public": {
          "type": "boolean",
          "default": true
        },
        "is_edited": {
          "type": "boolean",
          "default": false
        },
        "is_deleted": {
          "type": "boolean",
          "default": false
        }
      },
      "relations": {
        "user_id": {
          "type": "ManyToOne",
          "entity": "Users",
          "required": true
        },
        "reflection_likes": {
          "type": "OneToMany",
          "entity": "ReflectionLikes"
        },
        "reflection_replies": {
          "type": "OneToMany",
          "entity": "ReflectionReplies"
        }
      }
    },
    {
      "name": "ReflectionLikes",
      "create_pagination_route": false,
      "create_relation_get_route": false,
      "properties": {},
      "relations": {
        "reflection_id": {
          "type": "ManyToOne",
          "entity": "Reflections",
          "required": true
        },
        "user_id": {
          "type": "ManyToOne",
          "entity": "Users",
          "required": true
        }
      }
    },
    {
      "name": "ReflectionReplies",
      "create_pagination_route": false,
      "create_relation_get_route": false,
      "properties": {
        "content": {
          "type": "text",
          "required": true
        },
        "language": {
          "type": "varchar",
          "length": 10,
          "required": true
        },
        "is_deleted": {
          "type": "boolean",
          "default": false
        }
      },
      "relations": {
        "reflection_id": {
          "type": "ManyToOne",
          "entity": "Reflections",
          "required": true
        },
        "user_id": {
          "type": "ManyToOne",
          "entity": "Users",
          "required": true
        }
      }
    },
    {
      "name": "Reports",
      "create_pagination_route": true,
      "create_relation_get_route": false,
      "properties": {
        "reportable_type": {
          "type": "varchar",
          "length": 50,
          "required": true
        },
        "reportable_id": {
          "type": "int8",
          "required": true
        },
        "report_type": {
          "type": "varchar",
          "length": 50,
          "required": true
        },
        "description": {
          "type": "text",
          "required": false
        },
        "status": {
          "type": "varchar",
          "length": 20,
          "default": "pending"
        }
      },
      "relations": {
        "user_id": {
          "type": "ManyToOne",
          "entity": "Users",
          "required": true
        }
      }
    },

    {
      "name": "Reflections",
      "create_pagination_route": true,
      "create_relation_get_route": true,
      "properties": {
        "reflection_type": {
          "type": "varchar",
          "length": 50,
          "required": true
        },
        "surah_number": {
          "type": "int4",
          "required": true
        },
        "ayah_number": {
          "type": "int4",
          "required": true
        },
        "language": {
          "type": "varchar",
          "length": 10,
          "required": true
        },
        "content": {
          "type": "text",
          "required": true
        },
        "is_public": {
          "type": "boolean",
          "default": true
        },
        "is_edited": {
          "type": "boolean",
          "default": false
        },
        "is_deleted": {
          "type": "boolean",
          "default": false
        }
      },
      "relations": {
        "user_id": {
          "type": "ManyToOne",
          "entity": "Users",
          "required": true
        },
        "reflection_likes": {
          "type": "OneToMany",
          "entity": "ReflectionLikes"
        },
        "reflection_replies": {
          "type": "OneToMany",
          "entity": "ReflectionReplies"
        }
      }
    },
    {
      "name": "Languages",
      "create_pagination_route": true,
      "create_relation_get_route": true,
      "properties": {
        "code": {
          "type": "varchar",
          "length": 10,
          "required": true
        },
        "name": {
          "type": "text",
          "length": 100,
          "required": true
        },
        "native_name": {
          "type": "text",
          "length": 100,
          "required": true
        },
        "is_rtl": {
          "type": "boolean",
          "required": true
        },
        "is_active": {
          "type": "boolean",
          "default": true
        }
      },
      "relations": {}
    },
    {
      "name": "SurahTranslations",
      "create_pagination_route": true,
      "create_relation_get_route": true,
      "properties": {
        "name": {
          "type": "text",
          "length": 100,
          "required": true
        },
        "is_active": {
          "type": "boolean",
          "default": true
        }
      },
      "relations": {
        "surah_id": {
          "type": "ManyToOne",
          "entity": "Surahs",
          "required": true
        },
        "translation_id": {
          "type": "ManyToOne",
          "entity": "Translations",
          "required": true
        }
      }
    },
    {
      "name": "Reciters",
      "create_pagination_route": true,
      "create_relation_get_route": true,
      "properties": {
        "name": {
          "type": "text",
          "length": 100,
          "required": true
        },
        "slug": {
          "type": "text",
          "unique": true,
          "required": true
        },
        "bio": {
          "type": "text",
          "required": false
        },
        "image_url": {
          "type": "varchar",
          "required": false
        },
        "is_default": {
          "type": "boolean",
          "default": false
        },
        "is_active": {
          "type": "boolean",
          "default": true
        }
      },
      "relations": {
        "recitations": {
          "type": "OneToMany",
          "entity": "Recitations"
        }
      }
    },
    {
      "name": "Recitations",
      "create_pagination_route": true,
      "create_relation_get_route": true,
      "properties": {
        "style": {
          "type": "text",
          "length": 100
        },
        "audio_url": {
          "type": "text"
        },
        "s3_url": {
          "type": "text",
          "required": false
        },
        "duration": {
          "type": "int4",
          "required": false
        }
      },
      "relations": {
        "reciter_id": {
          "type": "ManyToOne",
          "entity": "Reciters",
          "required": true
        },
        "ayah_id": {
          "type": "ManyToOne",
          "entity": "Ayahs",
          "required": true
        }
      }
    },

    {
      "name": "SessionConfigs",
      "create_pagination_route": true,
      "create_relation_get_route": false,
      "properties": {
        "unit_type": {
          "type": "enum",
          "enum": ["AYAH", "PAGE", "RUKU"],
          "required": true
        },
        "unit_count": {
          "type": "int4",
          "required": true
        },
        "display_label": {
          "type": "varchar",
          "length": 100,
          "required": true
        },
        "estimated_minutes": {
          "type": "int4",
          "required": true
        },
        "is_active": {
          "type": "boolean",
          "default": true
        },
        "is_default": {
          "type": "boolean",
          "default": false
        },
        "sort_order": {
          "type": "int4",
          "default": 0
        },
        "locale_default": {
          "type": "varchar",
          "length": 10,
          "required": false,
          "comment": "ar, ur, en - which locale uses this as default"
        }
      },
      "relations": {
        "sessions": {
          "type": "OneToMany",
          "entity": "Sessions"
        },
        "user_onboarding_responses": {
          "type": "OneToMany",
          "entity": "UserOnboardingResponses"
        }
      }
    },
    {
      "name": "UserOnboardingResponses",
      "create_pagination_route": false,
      "create_relation_get_route": true,
      "properties": {
        "onboarding_goal": {
          "type": "enum",
          "length": 50,
          "required": true,
          "enum": [
            "MEDITATION_AND_CONTEMPLATION",
            "READING_SESSIONS",
            "COMPLETE_QURAN",
            "UNDERSTANDING_AND_LEARNING"
          ]
        },
        "preferred_reminder_time": {
          "type": "varchar",
          "length": 20,
          "required": false
        },
        "reminder_enabled": {
          "type": "boolean",
          "default": false
        },
        "reminder_time_type": {
          "type": "enum",
          "enum": ["CUSTOM", "PRAYER_TIME", "WORK_BREAK", "BEFORE_BED"],
          "required": false
        },
        "preferred_prayer_time": {
          "type": "enum",
          "enum": ["FAJR", "DHUHR", "ASR", "MAGHRIB", "ISHA"],
          "required": false
        }
      },
      "relations": {
        "user_id": {
          "type": "OneToOne",
          "entity": "Users",
          "required": false,
          "isOwner": false
        },
        "session_config_id": {
          "type": "ManyToOne",
          "entity": "SessionConfigs",
          "required": true
        }
      }
    },
    {
      "name": "Sessions",
      "create_pagination_route": true,
      "create_relation_get_route": true,
      "properties": {
        "session_date": {
          "type": "date",
          "required": true
        },
        "ayah_count": {
          "type": "int4",
          "required": true
        },
        "status": {
          "type": "enum",
          "enum": ["IN_PROGRESS", "COMPLETED", "OVERDUE"],
          "required": true,
          "default": "IN_PROGRESS"
        },
        "completed_at": {
          "type": "timestamptz",
          "required": false
        },
        "time_spent_seconds": {
          "type": "int4",
          "default": 0
        }
      },
      "relations": {
        "user_id": {
          "type": "ManyToOne",
          "entity": "Users",
          "required": true
        },
        "start_ayah_id": {
          "type": "ManyToOne",
          "entity": "Ayahs",
          "required": true
        },
        "end_ayah_id": {
          "type": "ManyToOne",
          "entity": "Ayahs",
          "required": true
        },
        "session_config_id": {
          "type": "ManyToOne",
          "entity": "SessionConfigs",
          "required": true
        },
        "user_progresses": {
          "type": "OneToMany",
          "entity": "UserProgress"
        }
      }
    },
    {
      "name": "UserProgress",
      "create_pagination_route": false,
      "create_relation_get_route": true,
      "properties": {
        "current_streak": {
          "type": "int4",
          "default": 0
        },
        "longest_streak": {
          "type": "int4",
          "default": 0
        },
        "last_session_date": {
          "type": "date",
          "required": false
        }
      },
      "relations": {
        "user_id": {
          "type": "OneToOne",
          "entity": "Users",
          "required": true,
          "isOwner": false
        },
        "last_completed_ayah_id": {
          "type": "ManyToOne",
          "entity": "Ayahs",
          "required": false
        },
        "last_session_id": {
          "type": "ManyToOne",
          "entity": "Sessions",
          "required": false
        }
      }
    },
    {
      "name": "TafsirBookmarks",
      "create_pagination_route": true,
      "create_relation_get_route": true,
      "properties": {
        "notes": {
          "type": "text",
          "required": false
        }
      },
      "relations": {
        "user_id": {
          "type": "ManyToOne",
          "entity": "Users",
          "required": true
        },
        "tafsir_id": {
          "type": "ManyToOne",
          "entity": "Tafsirs",
          "required": true
        }
      }
    },
    {
      "name": "AyahBookmarks",
      "create_pagination_route": true,
      "create_relation_get_route": true,
      "properties": {
        "notes": {
          "type": "text",
          "required": false
        }
      },
      "relations": {
        "user_id": {
          "type": "ManyToOne",
          "entity": "Users",
          "required": true
        },
        "ayah_id": {
          "type": "ManyToOne",
          "entity": "Ayahs",
          "required": true
        }
      }
    },
    {
      "name": "Challenges",
      "create_pagination_route": true,
      "create_relation_get_route": true,
      "properties": {
        "title": {
          "type": "varchar",
          "length": 255,
          "required": true
        },
        "description": {
          "type": "text",
          "required": true
        },
        "duration_days": {
          "type": "int4",
          "required": true,
          "comment": "Challenge duration in days (e.g., 3, 5, 7)"
        },
        "creator_type": {
          "type": "enum",
          "enum": ["ADMIN", "USER"],
          "default": "USER",
          "required": true
        },
        "status": {
          "type": "enum",
          "enum": ["DRAFT", "ACTIVE", "PENDING_VERIFICATION", "REJECTED", "ARCHIVED"],
          "required": true,
          "default": "PENDING_VERIFICATION"
        },
        "is_public": {
          "type": "boolean",
          "default": true,
          "comment": "Whether challenge is visible to all users"
        }
      },
      "relations": {
        "created_by_id": {
          "type": "ManyToOne",
          "entity": "Users",
          "required": true
        },
        "ayah_id": {
          "type": "ManyToOne",
          "entity": "Ayahs",
          "required": false,
          "comment": "Optional ayah reference for the challenge"
        },
        "challenge_participants": {
          "type": "OneToMany",
          "entity": "ChallengeParticipants"
        },
        "language_id": {
          "type": "ManyToOne",
          "entity": "Languages",
          "required": false
        }
      }
    },
    {
      "name": "ChallengeParticipants",
      "create_pagination_route": true,
      "create_relation_get_route": true,
      "properties": {
        "status": {
          "type": "enum",
          "enum": ["IN_PROGRESS", "COMPLETED", "FAILED", "ABANDONED"],
          "required": true,
          "default": "IN_PROGRESS"
        },
        "start_date": {
          "type": "date",
          "required": true
        },
        "end_date": {
          "type": "date",
          "required": false,
          "comment": "Expected end date based on duration"
        },
        "completed_date": {
          "type": "date",
          "required": false
        },
        "days_completed": {
          "type": "int4",
          "default": 0,
          "comment": "Number of days user has completed"
        },
        "current_streak": {
          "type": "int4",
          "default": 0,
          "comment": "Current consecutive days completed"
        },
        "notes": {
          "type": "text",
          "required": false,
          "comment": "User's personal notes for this challenge"
        }
      },
      "relations": {
        "challenge_id": {
          "type": "ManyToOne",
          "entity": "Challenges",
          "required": true
        },
        "user_id": {
          "type": "ManyToOne",
          "entity": "Users",
          "required": true
        }
      }
    },
    {
      "name": "Quizzes",
      "create_pagination_route": true,
      "create_relation_get_route": true,
      "properties": {
        "question": {
          "type": "text",
          "required": true
        },
        "option_a": {
          "type": "varchar",
          "length": 500,
          "required": true
        },
        "option_b": {
          "type": "varchar",
          "length": 500,
          "required": true
        },
        "option_c": {
          "type": "varchar",
          "length": 500,
          "required": false
        },
        "option_d": {
          "type": "varchar",
          "length": 500,
          "required": false
        },
        "option_e": {
          "type": "varchar",
          "length": 500,
          "required": false
        },
        "option_f": {
          "type": "varchar",
          "length": 500,
          "required": false
        },
        "option_g": {
          "type": "varchar",
          "length": 500,
          "required": false
        },
        "correct_answer": {
          "type": "enum",
          "enum": ["A", "B", "C", "D"],
          "required": true
        },
        "creator_type": {
          "type": "enum",
          "enum": ["ADMIN", "USER"],
          "required": true
        },
        "status": {
          "type": "enum",
          "enum": ["ACTIVE", "INACTIVE", "PENDING_REVIEW"],
          "default": "PENDING_REVIEW",
          "comment": "User quizzes start as PENDING_REVIEW"
        }
      },
      "relations": {
        "ayah_id": {
          "type": "ManyToOne",
          "entity": "Ayahs"
        },
        "language_id": {
          "type": "ManyToOne",
          "entity": "Languages",
          "required": true
        },
        "created_by_id": {
          "type": "ManyToOne",
          "entity": "Users",
          "required": true
        },
        "quiz_attempts": {
          "type": "OneToMany",
          "entity": "QuizAttempts"
        }
      }
    },
    {
      "name": "QuizAttempts",
      "create_pagination_route": false,
      "create_relation_get_route": false,
      "properties": {
        "selected_answer": {
          "type": "varchar",
          "length": 500,
          "required": true
        },
        "is_correct": {
          "type": "boolean",
          "required": true
        },
        "attempted_at": {
          "type": "timestamptz",
          "default": "NOW()"
        }
      },
      "relations": {
        "user_id": {
          "type": "ManyToOne",
          "entity": "Users",
          "required": true
        },
        "quiz_id": {
          "type": "ManyToOne",
          "entity": "Quizzes",
          "required": true
        }
      }
    },
    {
      "name": "ChallengeProgress",
      "create_pagination_route": false,
      "create_relation_get_route": false,
      "properties": {
        "progress_date": {
          "type": "date",
          "required": true,
          "comment": "Date of progress (YYYY-MM-DD)"
        },
        "count_completed": {
          "type": "int4",
          "default": 0,
          "comment": "Number of times completed today. For ONCE_DAILY: 0 or 1. For MULTIPLE_DAILY: actual count (e.g., 3/5)"
        },
        "is_completed": {
          "type": "boolean",
          "default": false,
          "comment": "True if daily target met (ONCE_DAILY: count >= 1, MULTIPLE_DAILY: count >= target_count_per_day)"
        }
      },
      "relations": {
        "participant_id": {
          "type": "ManyToOne",
          "entity": "ChallengeParticipants",
          "required": true
        }
      },
      "indexes": [
        {
          "columns": ["participant_id", "progress_date"],
          "unique": true,
          "name": "idx_challenge_progress_participant_date_unique"
        }
      ]
    },
    {
      "name": "Communities",
      "create_pagination_route": true,
      "create_relation_get_route": true,
      "properties": {
        "name": {
          "type": "varchar",
          "length": 100,
          "required": true
        },
        "description": {
          "type": "text",
          "required": false
        },
        "badge_url": {
          "type": "varchar",
          "length": 500,
          "required": false
        },
        "community_type": {
          "type": "enum",
          "enum": ["PUBLIC", "PRIVATE"],
          "required": true,
          "default": "PUBLIC",
          "useDbEnum": true
        },
        "join_code": {
          "type": "varchar",
          "length": 50,
          "required": false,
          "comment": "For private communities"
        },
        "is_active": {
          "type": "boolean",
          "default": true
        },
        "auto_approve_members": {
          "type": "boolean",
          "default": true,
          "comment": "default true for public communities"
        }
      },
      "relations": {
        "created_by_id": {
          "type": "ManyToOne",
          "entity": "Users",
          "required": true
        },
        "community_members": {
          "type": "OneToMany",
          "entity": "CommunityMembers"
        }
      }
    },
    {
      "name": "CommunityMembers",
      "create_pagination_route": true,
      "create_relation_get_route": true,
      "properties": {
        "role": {
          "type": "enum",
          "enum": ["ADMIN", "MEMBER"],
          "required": true,
          "default": "MEMBER",
          "useDbEnum": true
        },
        "status": {
          "type": "enum",
          "enum": ["ACTIVE", "LEFT"],
          "required": true,
          "default": "ACTIVE",
          "useDbEnum": true
        },
        "joined_at": {
          "type": "timestamptz",
          "required": true
        }
      },
      "relations": {
        "user_id": {
          "type": "ManyToOne",
          "entity": "Users",
          "required": true
        },
        "community_id": {
          "type": "ManyToOne",
          "entity": "Communities",
          "required": true
        }
      }
    },
    {
      "name": "Achievements",
      "create_pagination_route": true,
      "create_relation_get_route": false,
      "properties": {
        "title": {
          "type": "varchar",
          "length": 200,
          "required": true
        },
        "description": {
          "type": "text",
          "required": true
        },
        "icon_url": {
          "type": "varchar",
          "length": 500,
          "required": false
        },
        "achievement_type": {
          "type": "enum",
          "enum": ["STREAK", "SESSIONS", "CHALLENGES", "QUIZZES", "KHATAM"],
          "required": true,
          "useDbEnum": true
        },
        "criteria_value": {
          "type": "int4",
          "required": true,
          "comment": "e.g., 7 for 7-day streak"
        },
        "sort_order": {
          "type": "int4",
          "default": 0
        },
        "is_active": {
          "type": "boolean",
          "default": true
        }
      },
      "relations": {
        "user_achievements": {
          "type": "OneToMany",
          "entity": "UserAchievements"
        }
      }
    },
    {
      "name": "UserAchievements",
      "create_pagination_route": true,
      "create_relation_get_route": true,
      "properties": {
        "progress_value": {
          "type": "int4",
          "required": true,
          "default": 0
        },
        "is_completed": {
          "type": "boolean",
          "default": false
        },
        "completed_at": {
          "type": "timestamptz",
          "required": false
        }
      },
      "relations": {
        "user_id": {
          "type": "ManyToOne",
          "entity": "Users",
          "required": true
        },
        "achievement_id": {
          "type": "ManyToOne",
          "entity": "Achievements",
          "required": true
        }
      }
    }
  ]
}
